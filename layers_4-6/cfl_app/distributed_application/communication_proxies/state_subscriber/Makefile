######################################################################
# makefile_state_x64Linux4gcc7.3.0#
# (c) Copyright, Real-Time Innovations, 2012.  All rights reserved.
# RTI grants Licensee a license to use, modify, compile, and create
# derivative works of the software solely for use with RTI Connext DDS.
# Licensee may redistribute copies of the software provided that all such
# copies are subject to this license. The software is provided "as is",
# with no warranty of any type, including any warranty for fitness for
# any purpose. RTI is under no obligation to maintain or support the
# software. RTI shall not be liable for any incidental or consequential
# damages arising out of the use or inability to use the software.
#
#
# This makefile was automatically generated by RTI Code Generator (rtiddsgen)
# version 3.1.0.
#
#
# Note: This makefile is only meant to build our example applications and
#       may require alterations to build on your system.
#
# This makefile assumes that your build environment is already correctly
# configured. (For example, the correct version of your compiler and
# linker should be in your PATH.)
######################################################################

# If undefined in the environment default NDDSHOME to install dir
ifndef NDDSHOME
NDDSHOME := "/opt/rti_connext_dds-6.1.0"
endif

SOURCE_DIR = ./src

CDRSOURCES = state.idl
SOURCES = $(SOURCE_DIR)/state_plugin.cc $(SOURCE_DIR)/state.cc
COMMONSOURCES = $(notdir $(SOURCES))

EXEC = state_subscriber

amd64: x64Linux4gcc7.3.0
arm64: armv8Linux4gcc7.3.0

x64Linux4gcc7.3.0: obj.dir obj/amd64.dir $(COMMONSOURCES:%.cc=obj/amd64/%.o) \
	$(EXEC:%=obj/amd64/%.o) \
	$(EXEC:%=obj/amd64/%)

armv8Linux4gcc7.3.0: obj.dir obj/arm64.dir $(COMMONSOURCES:%.cc=obj/arm64/%.o) \
	$(EXEC:%=obj/arm64/%.o) \
	$(EXEC:%=obj/arm64/%)

obj/amd64/%: obj/amd64/%.o
	$(COMPILER_PATH)$(GCC_PREFIX)g++ -m64 $(ADDITIONAL_LINKER_FLAGS) -o $@ $@.o $(COMMONSOURCES:%.cc=obj/amd64/%.o) -L$(NDDSHOME)/lib/x64Linux4gcc7.3.0 -lnddscpp2z -lnddscz -lnddscorez -ldl -lm -lpthread -lrt -no-pie -rdynamic

obj/arm64/% : obj/arm64/%.o
	aarch64-linux-gnu-g++ -o $@ $@.o $(COMMONSOURCES:%.cc=obj/arm64/%.o) -L$(NDDSHOME)/lib/armv8Linux4gcc7.3.0 -lnddscpp2z -lnddscz -lnddscorez -ldl -lm -lpthread -lrt -no-pie -rdynamic

obj/amd64/%.o: $(SOURCE_DIR)/%.cc   $(SOURCE_DIR)/state.hh
	$(COMPILER_PATH)$(GCC_PREFIX)g++ -m64 -Wall $(ADDITIONAL_COMPILER_FLAGS) -std=c++14 -o $@ -DRTI_UNIX -DRTI_LINUX -DRTI_64BIT -DRTI_STATIC -I. -I$(NDDSHOME)/include -I$(NDDSHOME)/include/ndds -I$(NDDSHOME)/include/ndds/hpp -c $<

obj/arm64/%.o : $(SOURCE_DIR)/%.cc   $(SOURCE_DIR)/state.hh
	aarch64-linux-gnu-g++ -o $@ -fPIC -DRTI_UNIX -DRTI_LINUX -DRTI_64BIT -funwind-tables -DRTI_STATIC -I. -I$(NDDSHOME)/include -I$(NDDSHOME)/include/ndds -I$(NDDSHOME)/include/ndds/hpp -c $<

%.dir:
	@echo "Checking directory $*"
	@if [ ! -d $* ]; then \
		echo "Making directory $*"; \
		mkdir -p $* ; \
	fi;

.PHONY: clean
clean:
	rm -rf ./obj
